import{s as pe,n as T,r as ve}from"../chunks/scheduler.BvLojk_z.js";import{S as ye,i as ge,e as N,s as G,c as E,y as $,h as J,o as K,j as M,z as Z,g as O}from"../chunks/index.BkxjfHYW.js";var A=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function j(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function me(r){if(r.__esModule)return r;var o=r.default;if(typeof o=="function"){var e=function c(){return this instanceof c?Reflect.construct(o,arguments,this.constructor):o.apply(this,arguments)};e.prototype=o.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(r).forEach(function(c){var v=Object.getOwnPropertyDescriptor(r,c);Object.defineProperty(e,c,v.get?v:{enumerable:!0,get:function(){return r[c]}})}),e}var W={exports:{}},D,X;function Ce(){if(X)return D;X=1;var r=1e3,o=r*60,e=o*60,c=e*24,v=c*7,h=c*365.25;D=function(n,t){t=t||{};var l=typeof n;if(l==="string"&&n.length>0)return w(n);if(l==="number"&&isFinite(n))return t.long?p(n):y(n);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(n))};function w(n){if(n=String(n),!(n.length>100)){var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(n);if(t){var l=parseFloat(t[1]),u=(t[2]||"ms").toLowerCase();switch(u){case"years":case"year":case"yrs":case"yr":case"y":return l*h;case"weeks":case"week":case"w":return l*v;case"days":case"day":case"d":return l*c;case"hours":case"hour":case"hrs":case"hr":case"h":return l*e;case"minutes":case"minute":case"mins":case"min":case"m":return l*o;case"seconds":case"second":case"secs":case"sec":case"s":return l*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return l;default:return}}}}function y(n){var t=Math.abs(n);return t>=c?Math.round(n/c)+"d":t>=e?Math.round(n/e)+"h":t>=o?Math.round(n/o)+"m":t>=r?Math.round(n/r)+"s":n+"ms"}function p(n){var t=Math.abs(n);return t>=c?i(n,t,c,"day"):t>=e?i(n,t,e,"hour"):t>=o?i(n,t,o,"minute"):t>=r?i(n,t,r,"second"):n+" ms"}function i(n,t,l,u){var g=t>=l*1.5;return Math.round(n/l)+" "+u+(g?"s":"")}return D}function we(r){e.debug=e,e.default=e,e.coerce=p,e.disable=h,e.enable=v,e.enabled=w,e.humanize=Ce(),e.destroy=i,Object.keys(r).forEach(n=>{e[n]=r[n]}),e.names=[],e.skips=[],e.formatters={};function o(n){let t=0;for(let l=0;l<n.length;l++)t=(t<<5)-t+n.charCodeAt(l),t|=0;return e.colors[Math.abs(t)%e.colors.length]}e.selectColor=o;function e(n){let t,l=null,u,g;function d(...f){if(!d.enabled)return;const _=d,s=Number(new Date),a=s-(t||s);_.diff=a,_.prev=t,_.curr=s,t=s,f[0]=e.coerce(f[0]),typeof f[0]!="string"&&f.unshift("%O");let m=0;f[0]=f[0].replace(/%([a-zA-Z%])/g,(F,b)=>{if(F==="%%")return"%";m++;const x=e.formatters[b];if(typeof x=="function"){const B=f[m];F=x.call(_,B),f.splice(m,1),m--}return F}),e.formatArgs.call(_,f),(_.log||e.log).apply(_,f)}return d.namespace=n,d.useColors=e.useColors(),d.color=e.selectColor(n),d.extend=c,d.destroy=e.destroy,Object.defineProperty(d,"enabled",{enumerable:!0,configurable:!1,get:()=>l!==null?l:(u!==e.namespaces&&(u=e.namespaces,g=e.enabled(n)),g),set:f=>{l=f}}),typeof e.init=="function"&&e.init(d),d}function c(n,t){const l=e(this.namespace+(typeof t>"u"?":":t)+n);return l.log=this.log,l}function v(n){e.save(n),e.namespaces=n,e.names=[],e.skips=[];let t;const l=(typeof n=="string"?n:"").split(/[\s,]+/),u=l.length;for(t=0;t<u;t++)l[t]&&(n=l[t].replace(/\*/g,".*?"),n[0]==="-"?e.skips.push(new RegExp("^"+n.slice(1)+"$")):e.names.push(new RegExp("^"+n+"$")))}function h(){const n=[...e.names.map(y),...e.skips.map(y).map(t=>"-"+t)].join(",");return e.enable(""),n}function w(n){if(n[n.length-1]==="*")return!0;let t,l;for(t=0,l=e.skips.length;t<l;t++)if(e.skips[t].test(n))return!1;for(t=0,l=e.names.length;t<l;t++)if(e.names[t].test(n))return!0;return!1}function y(n){return n.toString().substring(2,n.toString().length-2).replace(/\.\*\?$/,"*")}function p(n){return n instanceof Error?n.stack||n.message:n}function i(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return e.enable(e.load()),e}var _e=we;(function(r,o){var e={};o.formatArgs=v,o.save=h,o.load=w,o.useColors=c,o.storage=y(),o.destroy=(()=>{let i=!1;return()=>{i||(i=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),o.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function c(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function v(i){if(i[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+i[0]+(this.useColors?"%c ":" ")+"+"+r.exports.humanize(this.diff),!this.useColors)return;const n="color: "+this.color;i.splice(1,0,n,"color: inherit");let t=0,l=0;i[0].replace(/%[a-zA-Z%]/g,u=>{u!=="%%"&&(t++,u==="%c"&&(l=t))}),i.splice(l,0,n)}o.log=console.debug||console.log||(()=>{});function h(i){try{i?o.storage.setItem("debug",i):o.storage.removeItem("debug")}catch{}}function w(){let i;try{i=o.storage.getItem("debug")}catch{}return!i&&typeof process<"u"&&"env"in process&&(i=e.DEBUG),i}function y(){try{return localStorage}catch{}}r.exports=_e(o);const{formatters:p}=r.exports;p.j=function(i){try{return JSON.stringify(i)}catch(n){return"[UnexpectedJSONParseError]: "+n.message}}})(W,W.exports);var Fe=W.exports;const be=j(Fe);var oe={exports:{}};(function(r){var o=Object.prototype.hasOwnProperty,e="~";function c(){}Object.create&&(c.prototype=Object.create(null),new c().__proto__||(e=!1));function v(p,i,n){this.fn=p,this.context=i,this.once=n||!1}function h(p,i,n,t,l){if(typeof n!="function")throw new TypeError("The listener must be a function");var u=new v(n,t||p,l),g=e?e+i:i;return p._events[g]?p._events[g].fn?p._events[g]=[p._events[g],u]:p._events[g].push(u):(p._events[g]=u,p._eventsCount++),p}function w(p,i){--p._eventsCount===0?p._events=new c:delete p._events[i]}function y(){this._events=new c,this._eventsCount=0}y.prototype.eventNames=function(){var i=[],n,t;if(this._eventsCount===0)return i;for(t in n=this._events)o.call(n,t)&&i.push(e?t.slice(1):t);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(n)):i},y.prototype.listeners=function(i){var n=e?e+i:i,t=this._events[n];if(!t)return[];if(t.fn)return[t.fn];for(var l=0,u=t.length,g=new Array(u);l<u;l++)g[l]=t[l].fn;return g},y.prototype.listenerCount=function(i){var n=e?e+i:i,t=this._events[n];return t?t.fn?1:t.length:0},y.prototype.emit=function(i,n,t,l,u,g){var d=e?e+i:i;if(!this._events[d])return!1;var f=this._events[d],_=arguments.length,s,a;if(f.fn){switch(f.once&&this.removeListener(i,f.fn,void 0,!0),_){case 1:return f.fn.call(f.context),!0;case 2:return f.fn.call(f.context,n),!0;case 3:return f.fn.call(f.context,n,t),!0;case 4:return f.fn.call(f.context,n,t,l),!0;case 5:return f.fn.call(f.context,n,t,l,u),!0;case 6:return f.fn.call(f.context,n,t,l,u,g),!0}for(a=1,s=new Array(_-1);a<_;a++)s[a-1]=arguments[a];f.fn.apply(f.context,s)}else{var m=f.length,C;for(a=0;a<m;a++)switch(f[a].once&&this.removeListener(i,f[a].fn,void 0,!0),_){case 1:f[a].fn.call(f[a].context);break;case 2:f[a].fn.call(f[a].context,n);break;case 3:f[a].fn.call(f[a].context,n,t);break;case 4:f[a].fn.call(f[a].context,n,t,l);break;default:if(!s)for(C=1,s=new Array(_-1);C<_;C++)s[C-1]=arguments[C];f[a].fn.apply(f[a].context,s)}}return!0},y.prototype.on=function(i,n,t){return h(this,i,n,t,!1)},y.prototype.once=function(i,n,t){return h(this,i,n,t,!0)},y.prototype.removeListener=function(i,n,t,l){var u=e?e+i:i;if(!this._events[u])return this;if(!n)return w(this,u),this;var g=this._events[u];if(g.fn)g.fn===n&&(!l||g.once)&&(!t||g.context===t)&&w(this,u);else{for(var d=0,f=[],_=g.length;d<_;d++)(g[d].fn!==n||l&&!g[d].once||t&&g[d].context!==t)&&f.push(g[d]);f.length?this._events[u]=f.length===1?f[0]:f:w(this,u)}return this},y.prototype.removeAllListeners=function(i){var n;return i?(n=e?e+i:i,this._events[n]&&w(this,n)):(this._events=new c,this._eventsCount=0),this},y.prototype.off=y.prototype.removeListener,y.prototype.addListener=y.prototype.on,y.prefixed=e,y.EventEmitter=y,r.exports=y})(oe);var xe=oe.exports;const Y=j(xe);var P=null;typeof WebSocket<"u"?P=WebSocket:typeof MozWebSocket<"u"?P=MozWebSocket:typeof global<"u"?P=global.WebSocket||global.MozWebSocket:typeof window<"u"?P=window.WebSocket||window.MozWebSocket:typeof self<"u"&&(P=self.WebSocket||self.MozWebSocket);const Q=P;var ie={exports:{}};function Be(r){throw new Error('Could not dynamically require "'+r+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var U={exports:{}};const Re={},Ie=Object.freeze(Object.defineProperty({__proto__:null,default:Re},Symbol.toStringTag,{value:"Module"})),ke=me(Ie);var ee;function ae(){return ee||(ee=1,function(r,o){(function(e,c){r.exports=c()})(A,function(){var e=e||function(c,v){var h;if(typeof window<"u"&&window.crypto&&(h=window.crypto),typeof self<"u"&&self.crypto&&(h=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(h=globalThis.crypto),!h&&typeof window<"u"&&window.msCrypto&&(h=window.msCrypto),!h&&typeof A<"u"&&A.crypto&&(h=A.crypto),!h&&typeof Be=="function")try{h=ke}catch{}var w=function(){if(h){if(typeof h.getRandomValues=="function")try{return h.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof h.randomBytes=="function")try{return h.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},y=Object.create||function(){function s(){}return function(a){var m;return s.prototype=a,m=new s,s.prototype=null,m}}(),p={},i=p.lib={},n=i.Base=function(){return{extend:function(s){var a=y(this);return s&&a.mixIn(s),(!a.hasOwnProperty("init")||this.init===a.init)&&(a.init=function(){a.$super.init.apply(this,arguments)}),a.init.prototype=a,a.$super=this,a},create:function(){var s=this.extend();return s.init.apply(s,arguments),s},init:function(){},mixIn:function(s){for(var a in s)s.hasOwnProperty(a)&&(this[a]=s[a]);s.hasOwnProperty("toString")&&(this.toString=s.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),t=i.WordArray=n.extend({init:function(s,a){s=this.words=s||[],a!=v?this.sigBytes=a:this.sigBytes=s.length*4},toString:function(s){return(s||u).stringify(this)},concat:function(s){var a=this.words,m=s.words,C=this.sigBytes,F=s.sigBytes;if(this.clamp(),C%4)for(var b=0;b<F;b++){var x=m[b>>>2]>>>24-b%4*8&255;a[C+b>>>2]|=x<<24-(C+b)%4*8}else for(var B=0;B<F;B+=4)a[C+B>>>2]=m[B>>>2];return this.sigBytes+=F,this},clamp:function(){var s=this.words,a=this.sigBytes;s[a>>>2]&=4294967295<<32-a%4*8,s.length=c.ceil(a/4)},clone:function(){var s=n.clone.call(this);return s.words=this.words.slice(0),s},random:function(s){for(var a=[],m=0;m<s;m+=4)a.push(w());return new t.init(a,s)}}),l=p.enc={},u=l.Hex={stringify:function(s){for(var a=s.words,m=s.sigBytes,C=[],F=0;F<m;F++){var b=a[F>>>2]>>>24-F%4*8&255;C.push((b>>>4).toString(16)),C.push((b&15).toString(16))}return C.join("")},parse:function(s){for(var a=s.length,m=[],C=0;C<a;C+=2)m[C>>>3]|=parseInt(s.substr(C,2),16)<<24-C%8*4;return new t.init(m,a/2)}},g=l.Latin1={stringify:function(s){for(var a=s.words,m=s.sigBytes,C=[],F=0;F<m;F++){var b=a[F>>>2]>>>24-F%4*8&255;C.push(String.fromCharCode(b))}return C.join("")},parse:function(s){for(var a=s.length,m=[],C=0;C<a;C++)m[C>>>2]|=(s.charCodeAt(C)&255)<<24-C%4*8;return new t.init(m,a)}},d=l.Utf8={stringify:function(s){try{return decodeURIComponent(escape(g.stringify(s)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(s){return g.parse(unescape(encodeURIComponent(s)))}},f=i.BufferedBlockAlgorithm=n.extend({reset:function(){this._data=new t.init,this._nDataBytes=0},_append:function(s){typeof s=="string"&&(s=d.parse(s)),this._data.concat(s),this._nDataBytes+=s.sigBytes},_process:function(s){var a,m=this._data,C=m.words,F=m.sigBytes,b=this.blockSize,x=b*4,B=F/x;s?B=c.ceil(B):B=c.max((B|0)-this._minBufferSize,0);var k=B*b,I=c.min(k*4,F);if(k){for(var S=0;S<k;S+=b)this._doProcessBlock(C,S);a=C.splice(0,k),m.sigBytes-=I}return new t.init(a,I)},clone:function(){var s=n.clone.call(this);return s._data=this._data.clone(),s},_minBufferSize:0});i.Hasher=f.extend({cfg:n.extend(),init:function(s){this.cfg=this.cfg.extend(s),this.reset()},reset:function(){f.reset.call(this),this._doReset()},update:function(s){return this._append(s),this._process(),this},finalize:function(s){s&&this._append(s);var a=this._doFinalize();return a},blockSize:16,_createHelper:function(s){return function(a,m){return new s.init(m).finalize(a)}},_createHmacHelper:function(s){return function(a,m){return new _.HMAC.init(s,m).finalize(a)}}});var _=p.algo={};return p}(Math);return e})}(U)),U.exports}(function(r,o){(function(e,c){r.exports=c(ae())})(A,function(e){return function(c){var v=e,h=v.lib,w=h.WordArray,y=h.Hasher,p=v.algo,i=[],n=[];(function(){function u(_){for(var s=c.sqrt(_),a=2;a<=s;a++)if(!(_%a))return!1;return!0}function g(_){return(_-(_|0))*4294967296|0}for(var d=2,f=0;f<64;)u(d)&&(f<8&&(i[f]=g(c.pow(d,1/2))),n[f]=g(c.pow(d,1/3)),f++),d++})();var t=[],l=p.SHA256=y.extend({_doReset:function(){this._hash=new w.init(i.slice(0))},_doProcessBlock:function(u,g){for(var d=this._hash.words,f=d[0],_=d[1],s=d[2],a=d[3],m=d[4],C=d[5],F=d[6],b=d[7],x=0;x<64;x++){if(x<16)t[x]=u[g+x]|0;else{var B=t[x-15],k=(B<<25|B>>>7)^(B<<14|B>>>18)^B>>>3,I=t[x-2],S=(I<<15|I>>>17)^(I<<13|I>>>19)^I>>>10;t[x]=k+t[x-7]+S+t[x-16]}var le=m&C^~m&F,fe=f&_^f&s^_&s,ue=(f<<30|f>>>2)^(f<<19|f>>>13)^(f<<10|f>>>22),de=(m<<26|m>>>6)^(m<<21|m>>>11)^(m<<7|m>>>25),V=b+de+le+n[x]+t[x],he=ue+fe;b=F,F=C,C=m,m=a+V|0,a=s,s=_,_=f,f=V+he|0}d[0]=d[0]+f|0,d[1]=d[1]+_|0,d[2]=d[2]+s|0,d[3]=d[3]+a|0,d[4]=d[4]+m|0,d[5]=d[5]+C|0,d[6]=d[6]+F|0,d[7]=d[7]+b|0},_doFinalize:function(){var u=this._data,g=u.words,d=this._nDataBytes*8,f=u.sigBytes*8;return g[f>>>5]|=128<<24-f%32,g[(f+64>>>9<<4)+14]=c.floor(d/4294967296),g[(f+64>>>9<<4)+15]=d,u.sigBytes=g.length*4,this._process(),this._hash},clone:function(){var u=y.clone.call(this);return u._hash=this._hash.clone(),u}});v.SHA256=y._createHelper(l),v.HmacSHA256=y._createHmacHelper(l)}(Math),e.SHA256})})(ie);var Pe=ie.exports;const te=j(Pe);var ce={exports:{}};(function(r,o){(function(e,c){r.exports=c(ae())})(A,function(e){return function(){var c=e,v=c.lib,h=v.WordArray,w=c.enc;w.Base64={stringify:function(p){var i=p.words,n=p.sigBytes,t=this._map;p.clamp();for(var l=[],u=0;u<n;u+=3)for(var g=i[u>>>2]>>>24-u%4*8&255,d=i[u+1>>>2]>>>24-(u+1)%4*8&255,f=i[u+2>>>2]>>>24-(u+2)%4*8&255,_=g<<16|d<<8|f,s=0;s<4&&u+s*.75<n;s++)l.push(t.charAt(_>>>6*(3-s)&63));var a=t.charAt(64);if(a)for(;l.length%4;)l.push(a);return l.join("")},parse:function(p){var i=p.length,n=this._map,t=this._reverseMap;if(!t){t=this._reverseMap=[];for(var l=0;l<n.length;l++)t[n.charCodeAt(l)]=l}var u=n.charAt(64);if(u){var g=p.indexOf(u);g!==-1&&(i=g)}return y(p,i,t)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="};function y(p,i,n){for(var t=[],l=0,u=0;u<i;u++)if(u%4){var g=n[p.charCodeAt(u-1)]<<u%4*2,d=n[p.charCodeAt(u)]>>>6-u%4*2,f=g|d;t[l>>>2]|=f<<24-l%4*8,l++}return h.create(t,l)}}(),e.enc.Base64})})(ce);var Ae=ce.exports;const ne=j(Ae);function z(){return z=Object.assign?Object.assign.bind():function(r){for(var o=1;o<arguments.length;o++){var e=arguments[o];for(var c in e)Object.prototype.hasOwnProperty.call(e,c)&&(r[c]=e[c])}return r},z.apply(this,arguments)}function Le(r,o){if(r==null)return{};var e={},c=Object.keys(r),v,h;for(h=0;h<c.length;h++)v=c[h],!(o.indexOf(v)>=0)&&(e[v]=r[v]);return e}var R;(function(r){r[r.Hello=0]="Hello",r[r.Identify=1]="Identify",r[r.Identified=2]="Identified",r[r.Reidentify=3]="Reidentify",r[r.Event=5]="Event",r[r.Request=6]="Request",r[r.RequestResponse=7]="RequestResponse",r[r.RequestBatch=8]="RequestBatch",r[r.RequestBatchResponse=9]="RequestBatchResponse"})(R||(R={}));var re;(function(r){r[r.None=0]="None",r[r.General=1]="General",r[r.Config=2]="Config",r[r.Scenes=4]="Scenes",r[r.Inputs=8]="Inputs",r[r.Transitions=16]="Transitions",r[r.Filters=32]="Filters",r[r.Outputs=64]="Outputs",r[r.SceneItems=128]="SceneItems",r[r.MediaInputs=256]="MediaInputs",r[r.Vendors=512]="Vendors",r[r.Ui=1024]="Ui",r[r.All=2047]="All",r[r.InputVolumeMeters=65536]="InputVolumeMeters",r[r.InputActiveStateChanged=131072]="InputActiveStateChanged",r[r.InputShowStateChanged=262144]="InputShowStateChanged",r[r.SceneItemTransformChanged=524288]="SceneItemTransformChanged"})(re||(re={}));var se;(function(r){r[r.None=-1]="None",r[r.SerialRealtime=0]="SerialRealtime",r[r.SerialFrame=1]="SerialFrame",r[r.Parallel=2]="Parallel"})(se||(se={}));function Se(r,o,e){const c=ne.stringify(te(e+r));return ne.stringify(te(c+o))}const Me=["authentication","rpcVersion"],H=be("obs-websocket-js");class q extends Error{constructor(o,e){super(e),this.code=void 0,this.code=o}}class L extends Y{constructor(...o){super(...o),this._identified=!1,this.internalListeners=new Y,this.socket=void 0}static generateMessageId(){return String(L.requestCounter++)}get identified(){return this._identified}async connect(o="ws://127.0.0.1:4455",e,c={}){var v=this;this.socket&&await this.disconnect();try{const h=this.internalEventPromise("ConnectionClosed"),w=this.internalEventPromise("ConnectionError");return await Promise.race([async function(){const y=await v.createConnection(o);return v.emit("Hello",y),v.identify(y,e,c)}(),new Promise((y,p)=>{w.then(i=>{i.message&&p(i)}),h.then(i=>{p(i)})})])}catch(h){throw await this.disconnect(),h}}async disconnect(){if(!this.socket||this.socket.readyState===Q.CLOSED)return;const o=this.internalEventPromise("ConnectionClosed");this.socket.close(),await o}async reidentify(o){const e=this.internalEventPromise(`op:${R.Identified}`);return await this.message(R.Reidentify,o),e}async call(o,e){const c=L.generateMessageId(),v=this.internalEventPromise(`res:${c}`);await this.message(R.Request,{requestId:c,requestType:o,requestData:e});const{requestStatus:h,responseData:w}=await v;if(!h.result)throw new q(h.code,h.comment);return w}async callBatch(o,e={}){const c=L.generateMessageId(),v=this.internalEventPromise(`res:${c}`);await this.message(R.RequestBatch,z({requestId:c,requests:o},e));const{results:h}=await v;return h}cleanup(){this.socket&&(this.socket.onopen=null,this.socket.onmessage=null,this.socket.onerror=null,this.socket.onclose=null,this.socket=void 0,this._identified=!1,this.internalListeners.removeAllListeners())}async createConnection(o){var e;const c=this.internalEventPromise("ConnectionOpened"),v=this.internalEventPromise(`op:${R.Hello}`);this.socket=new Q(o,this.protocol),this.socket.onopen=this.onOpen.bind(this),this.socket.onmessage=this.onMessage.bind(this),this.socket.onerror=this.onError.bind(this),this.socket.onclose=this.onClose.bind(this),await c;const h=(e=this.socket)==null?void 0:e.protocol;if(!h)throw new q(-1,"Server sent no subprotocol");if(h!==this.protocol)throw new q(-1,"Server sent an invalid subprotocol");return v}async identify(o,e,c={}){let{authentication:v,rpcVersion:h}=o,w=Le(o,Me);const y=z({rpcVersion:h},c);v&&e&&(y.authentication=Se(v.salt,v.challenge,e));const p=this.internalEventPromise(`op:${R.Identified}`);await this.message(R.Identify,y);const i=await p;return this._identified=!0,this.emit("Identified",i),z({rpcVersion:h},w,i)}async message(o,e){if(!this.socket)throw new Error("Not connected");if(!this.identified&&o!==1)throw new Error("Socket not identified");const c=await this.encodeMessage({op:o,d:e});this.socket.send(c)}async internalEventPromise(o){return new Promise(e=>{this.internalListeners.once(o,e)})}onOpen(o){H("socket.open"),this.emit("ConnectionOpened"),this.internalListeners.emit("ConnectionOpened",o)}async onMessage(o){try{const{op:e,d:c}=await this.decodeMessage(o.data);if(H("socket.message: %d %j",e,c),e===void 0||c===void 0)return;switch(e){case R.Event:{const{eventType:v,eventData:h}=c;this.emit(v,h);return}case R.RequestResponse:case R.RequestBatchResponse:{const{requestId:v}=c;this.internalListeners.emit(`res:${v}`,c);return}default:this.internalListeners.emit(`op:${e}`,c)}}catch(e){H("error handling message: %o",e)}}onError(o){H("socket.error: %o",o);const e=new q(-1,o.message);this.emit("ConnectionError",e),this.internalListeners.emit("ConnectionError",e)}onClose(o){H("socket.close: %s (%d)",o.reason,o.code);const e=new q(o.code,o.reason);this.emit("ConnectionClosed",e),this.internalListeners.emit("ConnectionClosed",e),this.cleanup()}}L.requestCounter=1;typeof exports<"u"&&Object.defineProperty(exports,"__esModule",{value:!0});class Oe extends L{constructor(...o){super(...o),this.protocol="obswebsocket.json"}async encodeMessage(o){return JSON.stringify(o)}async decodeMessage(o){return JSON.parse(o)}}function He(r){let o,e="IceCoach",c,v,h="Start Replay Buffer",w,y,p="Save Replay",i,n;return{c(){o=N("h1"),o.textContent=e,c=G(),v=N("button"),v.textContent=h,w=G(),y=N("button"),y.textContent=p,this.h()},l(t){o=E(t,"H1",{"data-svelte-h":!0}),$(o)!=="svelte-3udy1z"&&(o.textContent=e),c=J(t),v=E(t,"BUTTON",{title:!0,"data-svelte-h":!0}),$(v)!=="svelte-18yfbb6"&&(v.textContent=h),w=J(t),y=E(t,"BUTTON",{title:!0,"data-svelte-h":!0}),$(y)!=="svelte-1x0cbzx"&&(y.textContent=p),this.h()},h(){K(v,"title","Start Replay Buffer"),K(y,"title","Save Replay")},m(t,l){M(t,o,l),M(t,c,l),M(t,v,l),M(t,w,l),M(t,y,l),i||(n=[Z(v,"click",r[1]),Z(y,"click",r[0])],i=!0)},p:T,i:T,o:T,d(t){t&&(O(o),O(c),O(v),O(w),O(y)),i=!1,ve(n)}}}function qe(r){const o=new Oe;try{o.connect("ws://localhost:4455","password"),console.log("Connected to obs-websocket")}catch(w){console.log(w),w.message}function e(){o.call("SaveReplayBuffer"),setTimeout(v,2e3)}function c(){o.call("StartReplayBuffer")}async function v(){let w=await o.call("GetLastReplayBufferReplay");console.log("Replay saved at"+w.savedReplayPath),await o.call("CreateScene",{sceneName:"TestReplay"}),o.call("CreateInput",{sceneName:"TestReplay",inputName:"ReplaySource",inputKind:"ffmpeg_source",inputSettings:{local_file:w.savedReplayPath,looping:!0,speed_percent:50}}),setTimeout(h,2e3)}function h(){o.call("SetSceneItemTransform",{sceneItemId:1,sceneName:"TestReplay",sceneItemTransform:{scaleX:1.3333333730697632,scaleY:1.3333333730697632}})}return[e,c]}class Te extends ye{constructor(o){super(),ge(this,o,qe,He,pe,{})}}export{Te as component};
